# TR-2-3 SQL 基础

?> **该部分内容适合新手**<br/>如果你发现其中内容过于简单，请考虑**跳过以 TR 标识的章节**。

## MySQL 语句

如果你刚刚登录成功了，现在你就可以在终端中输入语句了。

我们先来学习第一条语句。

### 创建数据库

我们说，MySQL 中有许多数据库，一个数据库中有许多表。一般而言，一个应用程序使用一个数据库。

现在 MySQL 中还没有数据库，我们来创建一个，这是创建数据库的语句：

```sql
CREATE DATABASE <数据库名>;
```

*每一条 SQL 语句的最后都有分号。*

请注意这是一条**管理语句**，也就是说，只有我们这种登录到 MySQL 终端后的管理用户才有资格使用，一般的应用程序不可以（也没必要）使用。

例如，创建名为 `test` 的数据库：

```sql
CREATE DATABASE test;
```

*SQL 语句不区分大小写，上面的语句也可以写成 `create database test`。一般而言，我们用大写书写关键字，用小写和 `_` 表示标识符（各种名字）。*

### 选定数据库

```sql
USE <数据库名>;
```

这也是一条**管理语句**，用于切换当前使用的数据库。当你进入 MySQL 终端时是没有选定数据库的，这条语句用于选定一个数据库。

### 创建表

```sql
CREATE TABLE <表名> (
<标识符 1> <类型 1> PRIMARY KEY NOT NULL ,
<标识符 2> <类型 2> NOT NULL,
<更多标识符> <更多类型>,
<最后一个标识符> <类型后面不要加逗号>
);
```

MySQL 中的表必须在创建时规划好。

`PRIMARY KEY` 表示主键，主键被 MySQL 索引，提取时会有些许的性能提升，并且可以判断是否重复。一个表只能有一个主键。

`NOT NULL` 表示非空，插入数据时不允许插入 `NULL` 或者不插入。

这两个都是可以省略的。

*SQL 语句可以跨行，只有分号才表示结束，不换行也是可以的，表名和左括号之间的空格也不是必需的。*

比如，我们要创建一个存储玩家信息的数据表：

```sql
CREATE TABLE player_data (
uuid VARCHAR(255) PRIMARY KEY NOT NULL,
name TEXT NOT NULL,
isGirl BOOLEAN NOT NULL,
money INTEGER NOT NULL
);
```

*指定 `NOT NULL` 可以提供更高的安全性，不指定则可以在插入数据时更灵活。*

由于创建已经存在的表会触发错误，通常我们使用更聪明的：

```sql
CREATE TABLE IF NOT EXISTS <数据表名> (
（中间的内容）
) ;
```

这就不会出现错误了。

这是一条**应用语句**，这条语句可以被应用程序使用。

### 插入数据

```sql
INSERT INTO <表名> (<标签 1>, <标签 2>, <标签 3>) VALUES (<值 1>, <值 2>, <值 3>)
```

这是插入**一行**数据到指定的表中。所有注明了 `NOT NULL` 的标签都必须在 `VALUES` 前的括号中出现，`VALUES` 后面的括号中的值与 `VALUES` 一一对应。没有 `NOT NULL` 修饰的可以不提供，它将被设为空。

MySQL 在插入数据时**不覆盖**！也就是说，在 MySQL 中可以有完全相同的两行。

`INSERT INTO` 有一个变种：

```sql
INSERT INTO <表名>
(<标签 1>, <标签 2>, <标签 3>)
VALUES
(<值 1>, <值 2>, <值 3>)
ON DUPLICATE KEY UPDATE <标签>=<值>, <标签>=<值>;
```

这个版本会在主键 `PRIMARY KEY` 重复时执行后面的 `UPDATE` 操作，也就是设定指定的标签。这可以避免创建重复的行。

那有没有插入列的方法呢？很遗憾，没有。由于我们在创建表时就相当于指定了列，因此无法修改。

### 更新数据

```sql
UPDATE <表名> SET <标签 1>=<值 1>, <标签 2>=<值 2> WHERE <条件 1><操作符><值 1>
```

这用来更新指定的一行。

`WHERE` 是 MySQL 中的大杀器，它相当于 `if`，后面可以跟一些条件。

```sql
WHERE isGirl=true;
```

最基本的 `WHERE`，查找 `isGirl` 为真的行。

```sql
WHERE (money>=3000) OR (isGirl=true);
```

改进后的 `WHERE`，查找 `money` 大于等于 `3000` 或者 `isGirl` 的行。这里也可以用 `AND`。不过遗憾的是，MySQL 不支持 `XOR`。

```sql
WHERE (isGirl=true) AND (name LIKE "%FHC");
```

*SQL 中所有的字符串都要打引号。*

`LIKE` 用于执行一次通配符匹配，`%` 表示任意长度任意数量的字符。如果不使用 `%`，`LIKE` 和等号是一样的。上面这个方法用于查找任何以 `FHC` 结尾的小姐姐。

*咳……这不叫暗示，这叫明示……*

`WHERE` 在查找主键时非常迅速，而在查找其它值则会有性能损耗。并且对于较大的数据类型（`LONGTEXT`、`BIGINT`、`LONGBLOB` 等）不一定能够返回正确的结果。

### 读出值

```sql
SELECT (<标签 1>, <标签 2>) FROM <表名> WHERE <条件 1>, <条件 2>;
```

`SELECT` 从整个表中抄下来一部分。标签是选定指定的列，`WHERE` 和上面的用法一样，查找指定的行。

以上面创建的数据包为例，这一次我想查询服务器中所有的平民玩家和小姐姐的 `uuid`，就应该这样写：

```sql
SELECT uuid FROM player_data WHERE (isGirl=true) OR (money<3000);
```

*仅选择一列时，括号可以省略。*

在终端中，MySQL 会将返回值直接以表格的显示展示出来。

### 删除值

```sql
DELETE FROM <表名> WHERE <条件>;
```

用于删除一行或几行。如果不使用 `WHERE` 将删除所有的记录！

另外 `DELETE` 不支持删除一「格」，要这样做应该使用 `UPDATE WHERE`。

### 删除数据表

```sql
DROP TABLE <表名>;
```

这会删除一个表的所有数据。不可撤销！

### 删除数据库

（学着点，将来~~删库跑路时~~会用到的！）

```sql
DROP DATABASE <数据库名>;
```

这也是一条**管理语句**。