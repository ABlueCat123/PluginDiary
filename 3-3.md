# 3-3 深入研究玩家

玩家是 Minecraft 的主体，没有玩家还谈什么游戏！

这一节我们专门研究玩家，这个类是 `Player` 接口。

## 与玩家有关的事件

之前我们说过，`PlayerXXXEvent` 是属于玩家的事件，可以通过 `getPlayer` 获取涉及到的玩家。

## UUID

打开 `Player` 类的 JavaDocs（或者反编译查看源代码），你能看到许多方法。

UUID 是区别不同玩家所使用的标识符，正版账号的 UUID 由 Mojang 提供，盗版账号的 UUID 则由 `OfflinePlayer:` + 玩家的名字并进行哈希计算得出，当然这项工作已经由 Bukkit 为我们完成了。

`getUniqueId` 获得一个实体的 UUID，因为不仅玩家有 UUID，Minecraft 中的羊、末影龙、火焰弹也是有 UUID 的。

```java
UUID id = Bukkit.getPlayer("ThatRarityEG").getUniqueId();
// 无论在哪个服务端上，上面这个 id 都是相同的
```

正版玩家的 UUID 是**跟随账号**的，不会因改名而改变。不过，如果名字相同，盗版玩家的 UUID 也不会改变。因此，我们建议使用 UUID 查找玩家。

Bukkit 提供了通过 UUID 查找玩家的方法重载，签名如下：

```java
@Nullable
public static Player getPlayer(@NotNull UUID id)
```

另外还可以通过这个方法计算玩家的盗版 UUID：

```java
@Nullable
public static UUID getPlayerUniqueId(@NotNull String playerName)
```

这个方法**不需要玩家在线也能运转**，它这样工作：

- 如果服务器在离线模式下，则计算出这个名字对应的盗版 UUID
- 如果服务器在正版模式下，并且玩家没有注册正版账号，则返回 `null`。
- 如果服务器在正版模式下，并且玩家注册了正版账号……？？？

最后一种情况的行为是不确定的，得到的结果不可靠，因此，对于正版玩家，应当等玩家在线时再使用 `getUniqueId` 来获取 UUID。

## 踢出玩家

`kickPlayer` 方法用于将玩家踢出服务器。

```java
Bukkit.getPlayer("RarityEG").kickPlayer("信号不好");
```

就可以踢出名为 RarityEG 的玩家，踢出玩家时需要提供原因，所以这里可以填入诸如 `java.lang.NullPointerException` 或者「随机轰炸」之类的内容来迷惑玩家。（说真的——不要这样做！）

## 给予物品

要给玩家物品，一般使用 `getInventory` 获得物品栏再进行 `addItem`。这里一样是提供 `ItemStack`，它们的签名：

```java
@NotNull
PlayerInventory getInventory()
@NotNull
HashMap<Integer, ItemStack> addItem(@NotNull ItemStack... items) throws IllegalArgumentException
```

`addItem` 返回的 `HashMap` 中包含了新物品栏中槽位与物品的对应关系，不过大多数情况下我们不使用这个结果。

`ItemStack...` 表示「可以传入任意个 `ItemStack` 类型的参数」，一个可以，两个也可以，几十上百个呢？那可能就像它说的一样，会触发 `IllegalArgumentException` 异常。

这里的 `ItemStack` 和上一节中的一样，可以进行各种设置后再交给玩家。

要给玩家经验，直接使用 `Player` 接口的 `giveExp` 即可：

```java
default void giveExp(int amount)
```

它还有一个变种：

```java
void giveExp(int amount, boolean applyMending)
```

如果将 `applyMending` 设为 `false`，那么这次添加的经验将不会用于「经验修补」附魔的修复，而直接加入了玩家经验条。

如果要单独进行修复呢？

```java
int applyMending(int amount)
```

返回值是剩余的经验值。至于这些到底有没有加入到玩家的经验条中，要看各个版本的实现。

另外，如果要直接给玩家等级（在附魔时比较常用）：

```java
void giveExpLevels(int amount)
```

你可能会想知道玩家现在的经验等级：

```java
int getLevel()
```

还有一个不怎么常用的 `getExp` 方法：

```java
float getExp()
```

这个方法返回「到下一个等级的进度」，也就是说，如果你刚升到 26 级，那么这个值就接近 0，如果你马上就要 27 级了，那么这个值就接近 1。

如果要计算玩家的具体经验值，就需要先用 `getLevel` 获得等级，再通过 `getExp` 的结果获得经验进度，然后用 [这张表](https://wiki.biligame.com/mc/%E7%BB%8F%E9%AA%8C%E5%80%BC#%E5%8D%87%E7%BA%A7) 进行计算。这个相对而言比较困难，而且通常没有很大的意义（万一哪天 Mojang 改了经验值计算方式你就要重新来）。大多数情况下，有等级就足够了。

## 展示内容

展示给玩家的内容有几种：物品栏 GUI、书本视图、计分板、BOSS 血条等。

物品栏 GUI 我们已经说过，这里我们介绍书本视图。

要给玩家展示一本书，可以使用 `openBook` 方法：

```java
void openBook(@NotNull ItemStack book)
```

这里只能使用 `Material.WRITTEN_BOOK`，**不能使用** `Material.WRITING_BOOK`！

在调用 `openBook` 前：

- 先创建一个 `ItemStack`，转换为 `BookMeta`
- 确认 `ItemStack` 已经设置过了**标题**、**作者**、**内容**，三项缺一不可
- 玩家处在一个可以接受信息的状态，玩家如果正在激烈地战斗，把书显示出来显然不合适

## 操作玩家数据

玩家的生命值、饱食度、生命上限等都可设置：

```java
Player hacker = Bukkit.getPlayer("Hacker");
hacker.setHealth((double) 1);
hacker.setFoodLevel(1);
hacker.setMaxHealth((double) 1);
```

等等。需要注意的是有些方法（例如 `setHealth`）并没有写在 `Player` 接口中，而是写在了更通用的 `Damageable` 接口中，尝试使用 JavaDocs 中的搜索来找出它们吧！

## 设置资源包

这里的 `setResourcePack` 说到底也只是**建议**玩家使用资源包，若要强制使用可以手动检查玩家的资源包（稍后我们会说到）。

```java
Bukkit.getPlayer("RarityEG").setResourcePack("https\\://example.com/xxx.zip");
```

*这里第二个参数应该提供相应的 `hash`，但这里我为了省事省略了，不提供该参数的方法负载已经被 `@Deprecated`，不要使用它！*

---

以上只是有关玩家的非常非常少的一部分，一定要多查 JavaDocs！

[有关 `Player` 接口的 JavaDocs](https://papermc.io/javadocs/paper/1.16/org/bukkit/entity/Player.html)
